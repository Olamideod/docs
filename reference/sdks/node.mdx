---
title: "Node.js SDK"
description: "Official Node.js SDK for Protekt authentication and authorization"
---

# Node.js SDK

The official Node.js SDK for Protekt provides a simple and secure way to integrate authentication and authorization into your Node.js applications.

## Installation

```bash
npm install @protekt/node
# or
yarn add @protekt/node
```

## Quick Start

```javascript
const { Protekt } = require('@protekt/node');

const protekt = new Protekt({
  domain: 'your-tenant.protekt.com',
  clientId: 'your-client-id',
  clientSecret: 'your-client-secret'
});

// Authenticate a user
const user = await protekt.auth.login({
  email: 'user@example.com',
  password: 'password123'
});

console.log('User authenticated:', user);
```

## Configuration

### Initialize the SDK

```javascript
const protekt = new Protekt({
  domain: 'your-tenant.protekt.com',     // Your Protekt domain
  clientId: 'your-client-id',            // Your application client ID
  clientSecret: 'your-client-secret',    // Your application client secret
  redirectUri: 'http://localhost:3000/callback', // OAuth redirect URI
  scope: 'openid profile email'          // OAuth scopes
});
```

### Environment Variables

You can also configure the SDK using environment variables:

```bash
PROTEKT_DOMAIN=your-tenant.protekt.com
PROTEKT_CLIENT_ID=your-client-id
PROTEKT_CLIENT_SECRET=your-client-secret
PROTEKT_REDIRECT_URI=http://localhost:3000/callback
```

```javascript
const protekt = new Protekt(); // Uses environment variables automatically
```

## Authentication

### Password-based Authentication

```javascript
// Login with email and password
const result = await protekt.auth.login({
  email: 'user@example.com',
  password: 'password123'
});

console.log('Access token:', result.accessToken);
console.log('User:', result.user);
```

### Social Login

```javascript
// Login with Google
const result = await protekt.auth.loginWithProvider('google');

// Login with GitHub
const result = await protekt.auth.loginWithProvider('github');
```

### OAuth Flow

```javascript
// Generate authorization URL
const authUrl = protekt.auth.getAuthorizationUrl({
  scope: 'openid profile email',
  state: 'random-state-string'
});

// Handle callback
const tokens = await protekt.auth.handleCallback(req.query);

// Get user profile
const user = await protekt.auth.getUser(tokens.accessToken);
```

### Magic Link Authentication

```javascript
// Send magic link
await protekt.auth.sendMagicLink({
  email: 'user@example.com',
  redirectUri: 'http://localhost:3000/verify'
});

// Verify magic link token
const user = await protekt.auth.verifyMagicLink(token);
```

## User Management

### Get User Profile

```javascript
const user = await protekt.users.getProfile(accessToken);
console.log('User:', user);
```

### Update User Profile

```javascript
const updatedUser = await protekt.users.updateProfile(accessToken, {
  name: 'John Doe',
  picture: 'https://example.com/avatar.jpg'
});
```

### Get User by ID

```javascript
const user = await protekt.users.getById('user-id');
```

## Organizations

### List User Organizations

```javascript
const organizations = await protekt.organizations.list(accessToken);
```

### Get Organization

```javascript
const org = await protekt.organizations.get('org-id');
```

### Create Organization

```javascript
const org = await protekt.organizations.create({
  name: 'My Organization',
  displayName: 'My Org Display Name'
});
```

## Roles and Permissions

### List Roles

```javascript
const roles = await protekt.roles.list();
```

### Create Role

```javascript
const role = await protekt.roles.create({
  name: 'admin',
  description: 'Administrator role',
  permissions: ['read:users', 'write:users', 'delete:users']
});
```

### Assign Role to User

```javascript
await protekt.roles.assignToUser('user-id', 'role-id');
```

## Multi-Factor Authentication

### Enable MFA

```javascript
// Enable TOTP
const totpSetup = await protekt.mfa.enableTOTP(accessToken);

// Enable SMS
await protekt.mfa.enableSMS(accessToken, '+1234567890');

// Enable WebAuthn
const webauthnSetup = await protekt.mfa.enableWebAuthn(accessToken);
```

### Verify MFA

```javascript
// Verify TOTP code
await protekt.mfa.verifyTOTP(accessToken, '123456');

// Verify SMS code
await protekt.mfa.verifySMS(accessToken, '123456');
```

## Error Handling

```javascript
try {
  const user = await protekt.auth.login({
    email: 'user@example.com',
    password: 'wrong-password'
  });
} catch (error) {
  if (error.code === 'INVALID_CREDENTIALS') {
    console.log('Invalid email or password');
  } else if (error.code === 'MFA_REQUIRED') {
    console.log('MFA verification required');
  } else {
    console.log('Unexpected error:', error.message);
  }
}
```

## Middleware for Express

```javascript
const express = require('express');
const { ProtektMiddleware } = require('@protekt/node');

const app = express();

// Protect routes with authentication
app.use('/api', ProtektMiddleware({
  domain: 'your-tenant.protekt.com',
  audience: 'your-api-identifier'
}));

app.get('/api/protected', (req, res) => {
  // req.user contains the authenticated user
  res.json({ message: 'Hello, ' + req.user.name });
});
```

## WebSocket Support

```javascript
const { ProtektWebSocket } = require('@protekt/node');

const ws = new ProtektWebSocket({
  domain: 'your-tenant.protekt.com',
  accessToken: 'your-access-token'
});

ws.on('message', (data) => {
  console.log('Received:', data);
});

ws.send({ type: 'subscribe', channel: 'user-updates' });
```

## TypeScript Support

The SDK includes full TypeScript support:

```typescript
import { Protekt, User, Organization } from '@protekt/node';

const protekt = new Protekt({
  domain: 'your-tenant.protekt.com',
  clientId: 'your-client-id'
});

async function getUser(): Promise<User> {
  return await protekt.users.getProfile(accessToken);
}
```

## Examples

### Complete Authentication Flow

```javascript
const express = require('express');
const { Protekt } = require('@protekt/node');

const app = express();
const protekt = new Protekt({
  domain: 'your-tenant.protekt.com',
  clientId: 'your-client-id',
  clientSecret: 'your-client-secret',
  redirectUri: 'http://localhost:3000/callback'
});

// Login page
app.get('/login', (req, res) => {
  const authUrl = protekt.auth.getAuthorizationUrl({
    scope: 'openid profile email'
  });
  res.redirect(authUrl);
});

// OAuth callback
app.get('/callback', async (req, res) => {
  try {
    const tokens = await protekt.auth.handleCallback(req.query);
    const user = await protekt.auth.getUser(tokens.accessToken);
    
    // Store tokens in session
    req.session.accessToken = tokens.accessToken;
    req.session.user = user;
    
    res.redirect('/dashboard');
  } catch (error) {
    res.status(400).json({ error: error.message });
  }
});

// Protected route
app.get('/dashboard', async (req, res) => {
  if (!req.session.accessToken) {
    return res.redirect('/login');
  }
  
  try {
    const user = await protekt.auth.getUser(req.session.accessToken);
    res.json({ user });
  } catch (error) {
    res.redirect('/login');
  }
});

app.listen(3000);
```

## API Reference

For detailed API documentation, see the [API Reference](/reference/redocusaurus).

## Support

- **Documentation**: [docs.protekt.com](https://docs.protekt.com)
- **GitHub**: [github.com/protekt/node](https://github.com/protekt/node)
- **Support**: [support@protekt.com](mailto:support@protekt.com) 